:80 {
  encode zstd gzip

  log {
    output stdout
    format console
  }

  header {
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    X-XSS-Protection "1; mode=block"
    Referrer-Policy "strict-origin-when-cross-origin"
    Permissions-Policy "geolocation=(self), microphone=(), camera=(), payment=(self)"
  }

  handle /api/* {
    reverse_proxy backend:3001
  }

  handle /health* {
    reverse_proxy backend:3001
  }

  handle /ws/* {
    reverse_proxy backend:3001 {
      header_up Upgrade {http.request.header.Upgrade}
      header_up Connection {http.request.header.Connection}
    }
  }

  handle {
    reverse_proxy frontend:80
  }
}
